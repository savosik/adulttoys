import{r as n,A as m,a as ie,j as e,S as ce,x as L}from"./app-nMwxjLQ7.js";import{M as de}from"./MainLayout-BeTs2XOL.js";import{S as xe,P as he,N as ge,a as ue}from"./navigation-BtS5dvw2.js";import{u}from"./useStore-DLstr-6t.js";/* empty css            */const x={ArrowUpDown:l=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...l,children:[e.jsx("path",{d:"m21 16-4 4-4-4"}),e.jsx("path",{d:"M17 20V4"}),e.jsx("path",{d:"m3 8 4-4 4 4"}),e.jsx("path",{d:"M7 4v16"})]}),Heart:l=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...l,children:e.jsx("path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"})}),ShoppingCart:l=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...l,children:[e.jsx("circle",{cx:"8",cy:"21",r:"1"}),e.jsx("circle",{cx:"19",cy:"21",r:"1"}),e.jsx("path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"})]}),ArrowUp:l=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...l,children:e.jsx("path",{d:"m18 15-6-6-6 6"})}),Tag:l=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...l,children:[e.jsx("path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"}),e.jsx("path",{d:"M7 7h.01"})]}),MessageCircle:l=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...l,children:e.jsx("path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"})}),Search:l=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...l,children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.3-4.3"})]}),Mic:l=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...l,children:[e.jsx("path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}),e.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),e.jsx("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]})},je=l=>{const{products:i,categories:me,subCategories:p=[],filters:r}=l,[R,M]=n.useState((i==null?void 0:i.data)||[]),[w,$]=n.useState(!1),[b,Q]=n.useState(!1),[U,W]=n.useState(!1),[j,y]=n.useState(!1),[D,T]=n.useState(new Set(r.sub_category?String(r.sub_category).split(","):[]));n.useEffect(()=>{T(new Set(r.sub_category?String(r.sub_category).split(","):[]))},[r.sub_category]);const z=t=>{const s=String(t),c=new Set(D);c.has(s)?c.delete(s):c.add(s),T(c);const a=Array.from(c).join(",");m.get("/catalog",{...r,sub_category:a||void 0},{preserveState:!0,preserveScroll:!0,replace:!0})},[g,N]=n.useState(r.search||""),[f,A]=n.useState({products:[],categories:[]}),[H,h]=n.useState(!1),[F,v]=n.useState(!1),k=n.useRef(null),d=n.useRef(null),S=n.useRef(null),C=n.useRef(null),I=n.useRef(null),Z=[{label:"Сначала новые",value:"latest"},{label:"Дешевле",value:"price_asc"},{label:"Дороже",value:"price_desc"},{label:"По наличию",value:"stock_desc"},{label:"По названию (А-Я)",value:"name_asc"},{label:"По названию (Я-А)",value:"name_desc"},{label:"По популярности",value:"hit"},{label:"Новинки",value:"novelty"}],B=r.sort||"price_desc",q=u(t=>t.addToCart),O=u(t=>t.incrementCartQuantity),V=u(t=>t.decrementCartQuantity),E=u(t=>t.toggleFavorite),_=u(t=>t.isFavorite),Y=u(t=>t.toggleChatQueue),G=u(t=>t.cart),J=u(t=>t.chatQueue);n.useEffect(()=>{i&&(i.current_page===1?M(i.data||[]):M(t=>[...t,...i.data||[]]),$(!1))},[i]),n.useEffect(()=>{if(!i)return;const t=new IntersectionObserver(s=>{s[0].isIntersecting&&i.next_page_url&&!w&&($(!0),m.get(i.next_page_url,{},{preserveState:!0,preserveScroll:!0,only:["products"]}))},{threshold:.1});return C.current&&t.observe(C.current),()=>t.disconnect()},[i==null?void 0:i.next_page_url,w]),n.useEffect(()=>{const t=s=>{S.current&&!S.current.contains(s.target)&&y(!1),k.current&&!k.current.contains(s.target)&&h(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),n.useEffect(()=>{N(r.search||""),h(!1)},[r.search]),n.useEffect(()=>{if(g===r.search){h(!1);return}const t=setTimeout(()=>{g.length>=2?ie.get(`/search/suggestions?q=${g}`).then(s=>{A(s.data),h(!0)}):(A({products:[],categories:[]}),h(!1))},300);return()=>clearTimeout(t)},[g,r.search]),n.useEffect(()=>{if(typeof window<"u"&&("webkitSpeechRecognition"in window||"SpeechRecognition"in window)){const t=window.SpeechRecognition||window.webkitSpeechRecognition;d.current=new t,d.current.continuous=!1,d.current.interimResults=!1,d.current.lang="ru-RU",d.current.onresult=s=>{const c=s.results[0][0].transcript;N(c),v(!1),m.get("/catalog",{search:c},{preserveState:!1,preserveScroll:!1,replace:!1})},d.current.onerror=()=>v(!1),d.current.onend=()=>v(!1)}return()=>{var t;return(t=d.current)==null?void 0:t.stop()}},[r]);const K=t=>N(t.target.value),P=t=>{t==null||t.preventDefault(),h(!1),g.trim()?m.get("/catalog",{search:g},{preserveState:!1,preserveScroll:!1,replace:!1}):m.get("/catalog",{search:void 0},{preserveState:!1,preserveScroll:!1,replace:!1})},X=()=>{if(!d.current)return alert("Голосовой ввод не поддерживается");F?d.current.stop():(d.current.start(),v(!0))},ee=t=>{y(!1),m.get("/catalog",{...r,sort:t},{preserveState:!0,preserveScroll:!0,replace:!0})},te=(t,s)=>{t.preventDefault(),t.stopPropagation(),s.stock>0&&q(s)},se=(t,s)=>{t.preventDefault(),t.stopPropagation(),O(s)},re=(t,s)=>{t.preventDefault(),t.stopPropagation(),V(s)},ae=(t,s)=>{t.preventDefault(),t.stopPropagation(),E(s)},ne=(t,s)=>{t.preventDefault(),t.stopPropagation(),Y(s)},le=t=>{const s=t.target.scrollTop;W(s>500)},oe=()=>{var t;(t=I.current)==null||t.scrollTo({top:0,behavior:"smooth"})};return e.jsx(de,{children:e.jsxs(e.Fragment,{children:[e.jsx(ce,{title:"Каталог"}),e.jsx("div",{className:"bg-white shadow-sm flex-shrink-0 sticky top-0 z-20",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 relative",ref:k,children:[e.jsxs("form",{onSubmit:P,className:"relative",children:[e.jsx(x.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Поиск товаров...",value:g,onChange:K,onFocus:()=>g.length>=2&&h(!0),className:"w-full pl-9 pr-10 py-2 bg-gray-100 rounded-xl border-0 focus:ring-2 focus:ring-red-400 focus:bg-white transition-all text-sm"}),e.jsx("button",{type:"submit",className:"hidden","aria-hidden":"true"}),e.jsx("button",{type:"button",onClick:X,className:`absolute right-2 top-1/2 -translate-y-1/2 p-1.5 rounded-full transition-all ${F?"bg-red-500 text-white animate-pulse":"text-gray-400 hover:text-red-600 hover:bg-gray-200"}`,children:e.jsx(x.Mic,{className:"w-4 h-4"})})]}),H&&(f.products.length>0||f.categories.length>0)&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-2xl border border-gray-100 z-[9999] animate-in fade-in slide-in-from-top-2 duration-200 max-h-[70vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"overflow-y-auto flex-1",children:[f.categories.length>0&&e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"px-3 py-1 text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Категории"}),f.categories.map(t=>e.jsxs(L,{href:t.url,onClick:()=>h(!1),className:"flex items-center gap-3 px-3 py-2 hover:bg-red-50 rounded-lg transition-colors group",children:[t.icon_url?e.jsx("img",{src:t.icon_url,alt:"",className:"w-4 h-4 object-contain flex-shrink-0"}):e.jsx(x.Tag,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t.name})]},t.id))]}),f.products.length>0&&e.jsxs("div",{className:"p-2 border-t border-gray-50",children:[e.jsx("div",{className:"px-3 py-1 text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Товары"}),f.products.map(t=>{const s={id:t.id,name:t.name,price:t.price,image_main:t.image,stock:1},c=_(t.id);return e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 hover:bg-red-50 rounded-lg transition-colors group",children:[e.jsxs(L,{href:t.url,onClick:()=>h(!1),className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-50 rounded-lg overflow-hidden border border-gray-100 flex-shrink-0",children:e.jsx("img",{src:t.image||"https://placehold.co/100x100?text=No+Image",alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("div",{className:"text-xs text-red-600 font-bold",children:[new Intl.NumberFormat("ru-RU").format(t.price)," BYN"]}),t.reviews_count>0&&e.jsxs("div",{className:"flex items-center gap-0.5 text-[10px] text-gray-400",children:[e.jsx("span",{className:"text-yellow-500",children:"★"}),e.jsx("span",{children:Number(t.reviews_avg_rating).toFixed(1)}),e.jsxs("span",{children:["(",t.reviews_count,")"]})]})]})]})]}),e.jsx("button",{onClick:a=>{a.preventDefault(),a.stopPropagation(),E(s)},className:`w-8 h-8 rounded-lg flex items-center justify-center transition-colors ${c?"bg-red-50":"bg-gray-100 hover:bg-gray-200"}`,children:e.jsx(x.Heart,{className:`w-4 h-4 ${c?"fill-red-500 text-red-500":"text-gray-600"}`})})]},t.id)})]})]}),e.jsx("button",{onClick:P,className:"w-full p-3 bg-red-50 text-center text-xs font-bold text-red-600 hover:bg-red-100 transition-colors border-t border-gray-100",children:"Показать все результаты"})]})]}),e.jsxs("div",{className:"relative flex-shrink-0",ref:S,children:[e.jsx("button",{onClick:()=>y(!j),className:`p-2 rounded-lg transition-colors ${j?"bg-gray-200":"hover:bg-gray-100"}`,children:e.jsx(x.ArrowUpDown,{className:"w-6 h-6 text-gray-700"})}),j&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-xl border border-gray-100 z-50 py-2 animate-in fade-in slide-in-from-top-2 duration-200",children:[e.jsx("div",{className:"px-4 py-2 border-b border-gray-50 mb-1",children:e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Сортировка"})}),Z.map(t=>e.jsxs("button",{onClick:()=>ee(t.value),className:`w-full px-4 py-2.5 text-left text-sm transition-colors flex items-center justify-between ${B===t.value?"text-red-700 font-bold bg-red-50":"text-gray-600 hover:bg-gray-50"}`,children:[e.jsx("span",{children:t.label}),B===t.value&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-red-500"})]},t.value))]})]})]})})}),e.jsxs("main",{ref:I,onScroll:le,className:"flex-1 overflow-y-auto content-scroll relative",children:[e.jsxs("div",{className:"p-4",children:[p.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:`flex flex-wrap gap-2 transition-all duration-500 ease-in-out overflow-hidden ${b?"max-h-[2000px]":"max-h-[120px]"}`,children:p.map(t=>{const s=D.has(String(t.id));return e.jsxs("button",{onClick:()=>z(t.id),className:`px-3 py-1.5 rounded-lg text-[9px] font-bold transition-all border text-left leading-none flex items-center gap-1.5 break-words flex-shrink-0 max-w-[180px] sm:max-w-none ${s?"bg-red-700 text-white border-red-700 shadow-sm":"bg-white border-gray-200 text-gray-500 hover:border-red-300"}`,children:[e.jsx("span",{children:t.name}),s&&e.jsx("svg",{className:"w-2.5 h-2.5 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})]},t.id)})}),p.length>8&&e.jsxs("button",{onClick:()=>Q(!b),className:"w-full mt-4 py-2 bg-gray-50/50 rounded-xl text-red-500 text-[10px] font-bold uppercase tracking-widest flex items-center justify-center gap-2 hover:bg-gray-100 hover:text-red-700 transition-all border border-transparent hover:border-gray-200",children:[e.jsx("span",{children:b?"Скрыть лишнее":`Все подкатегории (${p.length})`}),e.jsx("svg",{className:`w-3.5 h-3.5 transition-transform duration-500 ${b?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]})]}),R.length>0?e.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 3xl:grid-cols-6 gap-4",children:R.map(t=>{const s=[t.image_main,...(t.additional_images||[]).map(a=>a.url)].filter(Boolean);s.length===0&&s.push("https://placehold.co/400x400/e5e7eb/6b7280?text=No+Image");const c=(()=>{const a=new URLSearchParams;r.category&&a.set("category",r.category),r.sub_category&&a.set("sub_category",r.sub_category),r.brand&&a.set("brand",r.brand),r.search&&a.set("search",r.search),r.sort&&a.set("sort",r.sort);const o=a.toString();return`/product/${t.id}${o?"?"+o:""}`})();return e.jsxs(L,{href:c,className:"bg-white rounded-2xl overflow-hidden shadow-sm group border border-gray-100 flex flex-col cursor-pointer hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"relative aspect-[2/3] overflow-hidden bg-gray-50",children:[e.jsx(xe,{modules:[he,ge],pagination:{clickable:!0},navigation:!0,className:"h-full w-full product-swiper",children:s.map((a,o)=>e.jsx(ue,{children:e.jsx("img",{src:a,alt:`${t.name} - ${o+1}`,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"})},o))}),t.old_price&&e.jsxs("div",{className:"absolute top-2 left-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-lg z-10",children:["-",Math.round((t.old_price-t.price)/t.old_price*100),"%"]})]}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-medium text-gray-900 text-sm mb-1 line-clamp-2 min-h-[2.5rem]",children:t.name}),e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx("span",{className:"text-yellow-500 text-sm",children:"★"}),e.jsx("span",{className:"text-xs text-gray-600",children:Number(t.reviews_avg_rating||0).toFixed(1)}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",t.reviews_count||0,")"]})]}),e.jsxs("div",{className:"flex items-end gap-2 mb-3",children:[e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:[new Intl.NumberFormat("ru-RU").format(t.price)," BYN"]}),t.old_price&&e.jsxs("span",{className:"text-xs text-gray-400 line-through mb-0.5",children:[new Intl.NumberFormat("ru-RU").format(t.old_price)," BYN"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:a=>ae(a,t),className:`flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center transition-colors ${_(t.id)?"bg-red-50 border border-red-200":"bg-gray-100 hover:bg-gray-200"}`,children:e.jsx(x.Heart,{className:`w-5 h-5 transition-all ${_(t.id)?"fill-red-500 stroke-red-500":"text-gray-600"}`})}),(()=>{const a=G.find(o=>o.id===t.id);return a?e.jsxs("div",{className:"flex-1 flex items-center gap-1 bg-green-600 rounded-xl overflow-hidden",children:[e.jsx("button",{onClick:o=>re(o,t.id),className:"w-10 h-10 flex items-center justify-center hover:bg-green-700 transition-colors text-white font-bold text-lg",children:"−"}),e.jsx("div",{className:"flex-1 text-center text-white font-bold text-sm",children:a.quantity}),e.jsx("button",{onClick:o=>se(o,t.id),className:"w-10 h-10 flex items-center justify-center hover:bg-green-700 transition-colors text-white font-bold text-lg",children:"+"})]}):e.jsx("button",{onClick:o=>te(o,t),className:`flex-1 py-2.5 rounded-xl font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 ${t.stock<=0?"bg-gray-200 text-gray-500":"bg-red-500 hover:bg-red-600 text-white"}`,disabled:t.stock<=0,children:t.stock>0?e.jsxs(e.Fragment,{children:[e.jsx(x.ShoppingCart,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm",children:[e.jsx("span",{className:"xs:hidden",children:"купить"}),e.jsx("span",{className:"hidden xs:inline",children:"сегодня"})]})]}):"Нет в наличии"})})(),(()=>{const a=J.some(o=>o.id===t.id);return e.jsx("button",{onClick:o=>ne(o,t),className:`flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center transition-colors ${a?"bg-red-50 border border-red-200":"bg-gray-100 hover:bg-gray-200"}`,children:e.jsx(x.MessageCircle,{className:`w-5 h-5 transition-all ${a?"fill-red-500 stroke-red-500":"text-gray-600"}`})})})()]})]})]},t.id)})}):!w&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-4 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(x.Search,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:"Ничего не найдено"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-xs",children:"Попробуйте изменить запрос или сбросить фильтры"}),e.jsx("button",{onClick:()=>m.get("/catalog"),className:"mt-6 px-6 py-2 bg-red-500 text-white rounded-xl text-sm font-bold hover:bg-red-600 transition-colors",children:"Сбросить все"})]}),e.jsx("div",{ref:C,className:"h-20 flex items-center justify-center mt-4",children:w&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]}),e.jsx("button",{onClick:oe,className:`fixed bottom-24 right-6 w-12 h-12 bg-white rounded-full shadow-lg flex items-center justify-center transition-all duration-300 z-50 border border-gray-100 ${U?"opacity-100 translate-y-0":"opacity-0 translate-y-10 pointer-events-none"}`,children:e.jsx(x.ArrowUp,{className:"w-6 h-6 text-red-700"})})]})]})})};export{je as default};
