import{r as e,g as t,G as r}from"./vendor-react-BM9Z6hcK.js";const n=e=>{let t;const r=new Set,n=(e,n)=>{const o="function"==typeof e?e(t):e;if(!Object.is(o,t)){const e=t;t=(null!=n?n:"object"!=typeof o||null===o)?o:Object.assign({},t,o),r.forEach(r=>r(t,e))}},o=()=>t,i={setState:n,getState:o,getInitialState:()=>a,subscribe:e=>(r.add(e),()=>r.delete(e)),destroy:()=>{r.clear()}},a=t=e(n,o,i);return i};var o={exports:{}},i={},a={exports:{}},s={},u=e;var l="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},c=u.useState,d=u.useEffect,p=u.useLayoutEffect,v=u.useDebugValue;function h(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!l(e,r)}catch(n){return!0}}var m="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),n=c({inst:{value:r,getSnapshot:t}}),o=n[0].inst,i=n[1];return p(function(){o.value=r,o.getSnapshot=t,h(o)&&i({inst:o})},[e,r,t]),d(function(){return h(o)&&i({inst:o}),e(function(){h(o)&&i({inst:o})})},[e]),v(r),r};s.useSyncExternalStore=void 0!==u.useSyncExternalStore?u.useSyncExternalStore:m,a.exports=s;var y=e,g=a.exports;
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},D=g.useSyncExternalStore,S=y.useRef,C=y.useEffect,E=y.useMemo,b=y.useDebugValue;i.useSyncExternalStoreWithSelector=function(e,t,r,n,o){var i=S(null);if(null===i.current){var a={hasValue:!1,value:null};i.current=a}else a=i.current;i=E(function(){function e(e){if(!u){if(u=!0,i=e,e=n(e),void 0!==o&&a.hasValue){var t=a.value;if(o(t,e))return s=t}return s=e}if(t=s,f(i,e))return t;var r=n(e);return void 0!==o&&o(t,r)?(i=e,t):(i=e,s=r)}var i,s,u=!1,l=void 0===r?null:r;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]},[t,r,n,o]);var s=D(e,i[0],i[1]);return C(function(){a.hasValue=!0,a.value=s},[s]),b(s),s},o.exports=i;const Q=t(o.exports),k={},{useDebugValue:O}=r,{useSyncExternalStoreWithSelector:F}=Q;let w=!1;const I=e=>e;const x=e=>{const t="function"==typeof e?(e=>e?n(e):n)(e):e,r=(e,r)=>function(e,t=I,r){"production"!==(k?"production":void 0)&&r&&!w&&(w=!0);const n=F(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return O(n),n}(t,e,r);return Object.assign(r,t),r};function j(e,t){let r;try{r=e()}catch(n){return}return{getItem:e=>{var t;const n=e=>null===e?null:JSON.parse(e,void 0),o=null!=(t=r.getItem(e))?t:null;return o instanceof Promise?o.then(n):n(o)},setItem:(e,t)=>r.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>r.removeItem(e)}}const z=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then:e=>z(e)(r),catch(e){return this}}}catch(r){return{then(e){return this},catch:e=>z(e)(r)}}},M=(T=((e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?((e,t)=>(r,n,o)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},a=!1;const s=new Set,u=new Set;let l;try{l=i.getStorage()}catch(y){}if(!l)return e((...e)=>{r(...e)},n,o);const c=z(i.serialize),d=()=>{const e=i.partialize({...n()});let t;const r=c({state:e,version:i.version}).then(e=>l.setItem(i.name,e)).catch(e=>{t=e});if(t)throw t;return r},p=o.setState;o.setState=(e,t)=>{p(e,t),d()};const v=e((...e)=>{r(...e),d()},n,o);let h;const m=()=>{var e;if(!l)return;a=!1,s.forEach(e=>e(n()));const t=(null==(e=i.onRehydrateStorage)?void 0:e.call(i,n()))||void 0;return z(l.getItem.bind(l))(i.name).then(e=>{if(e)return i.deserialize(e)}).then(e=>{if(e){if("number"!=typeof e.version||e.version===i.version)return e.state;if(i.migrate)return i.migrate(e.state,e.version)}}).then(e=>{var t;return h=i.merge(e,null!=(t=n())?t:v),r(h,!0),d()}).then(()=>{null==t||t(h,void 0),a=!0,u.forEach(e=>e(h))}).catch(e=>{null==t||t(void 0,e)})};return o.persist={setOptions:e=>{i={...i,...e},e.getStorage&&(l=e.getStorage())},clearStorage:()=>{null==l||l.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>m(),hasHydrated:()=>a,onHydrate:e=>(s.add(e),()=>{s.delete(e)}),onFinishHydration:e=>(u.add(e),()=>{u.delete(e)})},m(),h||v})(e,t):((e,t)=>(r,n,o)=>{let i={storage:j(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},a=!1;const s=new Set,u=new Set;let l=i.storage;if(!l)return e((...e)=>{r(...e)},n,o);const c=()=>{const e=i.partialize({...n()});return l.setItem(i.name,{state:e,version:i.version})},d=o.setState;o.setState=(e,t)=>{d(e,t),c()};const p=e((...e)=>{r(...e),c()},n,o);let v;o.getInitialState=()=>p;const h=()=>{var e,t;if(!l)return;a=!1,s.forEach(e=>{var t;return e(null!=(t=n())?t:p)});const o=(null==(t=i.onRehydrateStorage)?void 0:t.call(i,null!=(e=n())?e:p))||void 0;return z(l.getItem.bind(l))(i.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===i.version)return[!1,e.state];if(i.migrate)return[!0,i.migrate(e.state,e.version)]}return[!1,void 0]}).then(e=>{var t;const[o,a]=e;if(v=i.merge(a,null!=(t=n())?t:p),r(v,!0),o)return c()}).then(()=>{null==o||o(v,void 0),v=n(),a=!0,u.forEach(e=>e(v))}).catch(e=>{null==o||o(void 0,e)})};return o.persist={setOptions:e=>{i={...i,...e},e.storage&&(l=e.storage)},clearStorage:()=>{null==l||l.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>h(),hasHydrated:()=>a,onHydrate:e=>(s.add(e),()=>{s.delete(e)}),onFinishHydration:e=>(u.add(e),()=>{u.delete(e)})},i.skipHydration||h(),v||p})(e,t))((e,t)=>({cart:[],deliveryMethod:"pickup",courierDelivery:{name:"",address:"",phone:"",mapLat:null,mapLng:null,comment:""},courierDeliveryErrors:{name:"",address:"",phone:""},pickupDelivery:{name:"",phone:"",comment:""},pickupDeliveryErrors:{name:"",phone:""},postDelivery:{name:"",postalCode:"",region:"",city:"",house:"",apartment:"",phone:"",comment:""},postDeliveryErrors:{name:"",postalCode:"",region:"",city:"",house:"",apartment:"",phone:""},favorites:[],chatQueue:[],notification:null,addToCart:r=>{const{cart:n}=t(),o=n.find(e=>e.id===r.id);e(o?{cart:n.map(e=>e.id===r.id?{...e,quantity:e.quantity+1}:e)}:{cart:[...n,{...r,quantity:1}]})},removeFromCart:r=>{e({cart:t().cart.filter(e=>e.id!==r)})},updateCartQuantity:(r,n)=>{n<=0?t().removeFromCart(r):e({cart:t().cart.map(e=>e.id===r?{...e,quantity:n}:e)})},incrementCartQuantity:e=>{const r=t().cart.find(t=>t.id===e);r&&t().updateCartQuantity(e,r.quantity+1)},decrementCartQuantity:e=>{const r=t().cart.find(t=>t.id===e);r&&t().updateCartQuantity(e,r.quantity-1)},clearCart:()=>{e({cart:[]})},getCartTotal:()=>t().cart.reduce((e,t)=>e+t.price*t.quantity,0),getCartCount:()=>t().cart.reduce((e,t)=>e+t.quantity,0),addToFavorites:r=>{const{favorites:n}=t();n.find(e=>e.id===r.id)||e({favorites:[...n,r]})},removeFromFavorites:r=>{e({favorites:t().favorites.filter(e=>e.id!==r)})},toggleFavorite:e=>{const{favorites:r}=t();r.find(t=>t.id===e.id)?t().removeFromFavorites(e.id):t().addToFavorites(e)},isFavorite:e=>t().favorites.some(t=>t.id===e),getFavoritesCount:()=>t().favorites.length,clearFavorites:()=>{e({favorites:[]})},addToChatQueue:r=>{const{chatQueue:n}=t();n.find(e=>e.id===r.id)||e({chatQueue:[...n,r]})},removeFromChatQueue:r=>{e({chatQueue:t().chatQueue.filter(e=>e.id!==r)})},toggleChatQueue:e=>{const{chatQueue:r}=t();r.find(t=>t.id===e.id)?t().removeFromChatQueue(e.id):t().addToChatQueue(e)},clearChatQueue:()=>{e({chatQueue:[]})},getChatQueueCount:()=>t().chatQueue.length,showNotification:(t,r="success")=>{e({notification:{message:t,type:r,id:Date.now()}})},setDeliveryMethod:t=>{e({deliveryMethod:t})},getDeliveryCost:()=>{const{deliveryMethod:e}=t(),r=t().getCartTotal();switch(e){case"pickup":default:return 0;case"courier":return r>=100?0:15;case"post":return r>=200?0:20}},getOrderTotal:()=>t().getCartTotal()+t().getDeliveryCost(),setCourierDeliveryData:r=>{const n={...t().courierDelivery,...r};e({courierDelivery:n});const o={...t().courierDeliveryErrors};if("name"in r&&(!r.name||r.name.trim().length<2?o.name="Имя обязательно":o.name=""),"address"in r&&(!r.address||r.address.trim().length<10?o.address="Адрес должен содержать минимум 10 символов":o.address=""),"phone"in r){const e=/^\+375\s?\(?\d{2}\)?\s?\d{3}[-\s]?\d{2}[-\s]?\d{2}$/;r.phone?e.test(r.phone)?o.phone="":o.phone="Формат: +375 (29) 123-45-67":o.phone="Телефон обязателен для заполнения"}e({courierDeliveryErrors:o})},validateCourierDelivery:()=>{const{courierDelivery:r}=t(),n={};return(!r.name||r.name.trim().length<2)&&(n.name="Имя обязательно"),(!r.address||r.address.trim().length<10)&&(n.address="Адрес должен содержать минимум 10 символов"),r.phone?/^\+375\s?\(?\d{2}\)?\s?\d{3}[-\s]?\d{2}[-\s]?\d{2}$/.test(r.phone)||(n.phone="Формат: +375 (29) 123-45-67"):n.phone="Телефон обязателен для заполнения",e({courierDeliveryErrors:n}),0===Object.keys(n).length},clearCourierDeliveryData:()=>{e({courierDelivery:{name:"",address:"",phone:"",mapLat:null,mapLng:null,comment:""},courierDeliveryErrors:{name:"",address:"",phone:""}})},setPickupDeliveryData:r=>{const n={...t().pickupDelivery,...r};e({pickupDelivery:n});const o={...t().pickupDeliveryErrors};if("name"in r&&(!r.name||r.name.trim().length<2?o.name="Имя обязательно":o.name=""),"phone"in r){const e=/^\+375\s?\(?\d{2}\)?\s?\d{3}[-\s]?\d{2}[-\s]?\d{2}$/;r.phone?e.test(r.phone)?o.phone="":o.phone="Формат: +375 (29) 123-45-67":o.phone="Телефон обязателен"}e({pickupDeliveryErrors:o})},validatePickupDelivery:()=>{const{pickupDelivery:r}=t(),n={};return(!r.name||r.name.trim().length<2)&&(n.name="Имя обязательно"),r.phone?/^\+375\s?\(?\d{2}\)?\s?\d{3}[-\s]?\d{2}[-\s]?\d{2}$/.test(r.phone)||(n.phone="Формат: +375 (29) 123-45-67"):n.phone="Телефон обязателен",e({pickupDeliveryErrors:n}),0===Object.keys(n).length},clearPickupDeliveryData:()=>{e({pickupDelivery:{name:"",phone:"",comment:""},pickupDeliveryErrors:{name:"",phone:""}})},setPostDeliveryData:r=>{const n={...t().postDelivery,...r};e({postDelivery:n});const o={...t().postDeliveryErrors};if("name"in r&&(!r.name||r.name.trim().length<2?o.name="Имя обязательно":o.name=""),"postalCode"in r){const e=/^\d{6}$/;r.postalCode?e.test(r.postalCode)?o.postalCode="":o.postalCode="Индекс должен содержать 6 цифр":o.postalCode="Индекс обязателен"}if("region"in r&&(!r.region||r.region.trim().length<3?o.region="Укажите район (минимум 3 символа)":o.region=""),"city"in r&&(!r.city||r.city.trim().length<2?o.city="Укажите населенный пункт (минимум 2 символа)":o.city=""),"house"in r&&(r.house&&0!==r.house.trim().length?o.house="":o.house="Укажите номер дома"),"apartment"in r&&(r.apartment&&0!==r.apartment.trim().length?o.apartment="":o.apartment="Укажите номер квартиры"),"phone"in r){const e=/^\+375\s?\(?\d{2}\)?\s?\d{3}[-\s]?\d{2}[-\s]?\d{2}$/;r.phone?e.test(r.phone)?o.phone="":o.phone="Формат: +375 (29) 123-45-67":o.phone="Телефон обязателен"}e({postDeliveryErrors:o})},validatePostDelivery:()=>{const{postDelivery:r}=t(),n={};return(!r.name||r.name.trim().length<2)&&(n.name="Имя обязательно"),r.postalCode?/^\d{6}$/.test(r.postalCode)||(n.postalCode="Индекс должен содержать 6 цифр"):n.postalCode="Индекс обязателен",(!r.region||r.region.trim().length<3)&&(n.region="Укажите район (минимум 3 символа)"),(!r.city||r.city.trim().length<2)&&(n.city="Укажите населенный пункт (минимум 2 символа)"),r.house&&0!==r.house.trim().length||(n.house="Укажите номер дома"),r.apartment&&0!==r.apartment.trim().length||(n.apartment="Укажите номер квартиры"),r.phone?/^\+375\s?\(?\d{2}\)?\s?\d{3}[-\s]?\d{2}[-\s]?\d{2}$/.test(r.phone)||(n.phone="Формат: +375 (29) 123-45-67"):n.phone="Телефон обязателен",e({postDeliveryErrors:n}),0===Object.keys(n).length},clearPostDeliveryData:()=>{e({postDelivery:{postalCode:"",region:"",city:"",house:"",apartment:"",phone:"",comment:""},postDeliveryErrors:{postalCode:"",region:"",city:"",house:"",apartment:"",phone:""}})}}),{name:"ecom-storage",partialize:e=>({cart:e.cart,favorites:e.favorites,chatQueue:e.chatQueue,deliveryMethod:e.deliveryMethod,deliveryMethod:e.deliveryMethod,courierDelivery:e.courierDelivery,pickupDelivery:e.pickupDelivery,postDelivery:e.postDelivery})}))?x(T):x;var T;export{M as u};
