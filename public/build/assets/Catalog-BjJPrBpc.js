import{j as e}from"./app-JFefIfGz.js";import{r as t}from"./vendor-react-D8ePpywI.js";import{M as r}from"./MainLayout-kfLYubjd.js";import{A as s,S as n,a}from"./vendor-inertia-CTBPnMsl.js";import{u as o}from"./useStore-DuB4Tk4X.js";import{P as i}from"./ProductCard-mvMoDgIb.js";import"./pagination-CV6Cq4kt.js";import"./vendor-swiper-CNwGi3cp.js";import"./imageHelper-Mbc89JsA.js";const l=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:e.jsx("path",{d:"m18 15-6-6-6 6"})}),c=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.3-4.3"})]}),d=r=>{var a,d,u,x,g,p;const{products:h,categories:j,subCategories:y=[],filters:f,currentCategory:v=null,currentBrand:b=null}=r,[w,N]=t.useState((null==h?void 0:h.data)||[]),[S,k]=t.useState(!1),[_,C]=t.useState(!1),[L,E]=t.useState(new Set(f.sub_category?String(f.sub_category).split(","):[]));t.useEffect(()=>{E(new Set(f.sub_category?String(f.sub_category).split(","):[]))},[f.sub_category]);const[M,T]=t.useState(f.search||""),[$,A]=t.useState({products:[],categories:[]}),[B,I]=t.useState(!1),[Q,R]=t.useState(!1);t.useRef(null),t.useRef(null);const W=t.useRef(null),D=t.useRef(null),[H,F]=t.useState(!1);f.sort,o(e=>e.addToCart),o(e=>e.incrementCartQuantity),o(e=>e.decrementCartQuantity),o(e=>e.toggleFavorite),o(e=>e.favorites),o(e=>e.toggleChatQueue),o(e=>e.cart),o(e=>e.chatQueue),t.useEffect(()=>{h&&(1===h.current_page?N(h.data||[]):N(e=>{const t=h.data||[],r=new Set(e.map(e=>e.id)),s=t.filter(e=>!r.has(e.id));return 0===s.length?e:[...e,...s]}),k(!1))},[h]),t.useEffect(()=>{if(!h)return;const e=new IntersectionObserver(e=>{e[0].isIntersecting&&h.next_page_url&&!S&&(k(!0),s.get(h.next_page_url,{},{preserveState:!0,preserveScroll:!0,only:["products"]}))},{threshold:.1});return W.current&&e.observe(W.current),()=>e.disconnect()},[null==h?void 0:h.next_page_url,S]),t.useEffect(()=>{const e=()=>{if(D.current){const e=D.current.scrollTop;F(e>500)}},t=D.current;if(t)return t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(n,{title:(null==(a=r.meta)?void 0:a.title)||"Каталог товаров",children:[e.jsx("meta",{name:"description",content:(null==(d=r.meta)?void 0:d.description)||"Каталог товаров A-toys"}),e.jsx("meta",{property:"og:type",content:"website"}),e.jsx("meta",{property:"og:title",content:(null==(u=r.meta)?void 0:u.title)||"Каталог товаров"}),e.jsx("meta",{property:"og:description",content:(null==(x=r.meta)?void 0:x.description)||"Каталог товаров A-toys"}),e.jsx("meta",{name:"twitter:card",content:"summary"}),e.jsx("meta",{name:"twitter:title",content:(null==(g=r.meta)?void 0:g.title)||"Каталог товаров"}),e.jsx("meta",{name:"twitter:description",content:(null==(p=r.meta)?void 0:p.description)||"Каталог товаров A-toys"})]}),e.jsxs("main",{ref:D,className:"relative",children:[e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"sr-only",children:v?v.name:b?`Товары бренда ${b.name}`:f.search?`Поиск: ${f.search}`:"Каталог товаров"}),b&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:b.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Все товары бренда"})]}),y.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:y.map((t,r)=>{const n=L.has(String(t.id)),a=!_&&r>=5;return e.jsxs("button",{onClick:()=>(e=>{const t=String(e),r=new Set(L);r.has(t)?r.delete(t):r.add(t),E(r);const n=Array.from(r).join(","),a=f.category?`/category/${f.category}`:"/";s.get(a,{...f,category:void 0,sub_category:n||void 0},{preserveState:!0,preserveScroll:!0,replace:!0})})(t.id),className:`px-3 py-1.5 rounded-lg text-[9px] font-bold transition-all border text-left leading-none items-center gap-1.5 break-words flex-shrink-0 max-w-[180px] sm:max-w-none ${a?"hidden":"flex"} ${n?"bg-red-700 text-white border-red-700 shadow-sm":"bg-white border-gray-200 text-gray-500 hover:border-red-300"}`,children:[e.jsx("span",{children:t.name}),n&&e.jsx("svg",{className:"w-2.5 h-2.5 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})]},t.id)})}),y.length>5&&e.jsxs("button",{onClick:()=>C(!_),className:"w-full mt-4 py-2 bg-gray-50/50 rounded-xl text-red-500 text-[10px] font-bold uppercase tracking-widest flex items-center justify-center gap-2 hover:bg-gray-100 hover:text-red-700 transition-all border border-transparent hover:border-gray-200",children:[e.jsx("span",{children:_?"Скрыть лишнее":`Все подкатегории (${y.length})`}),e.jsx("svg",{className:"w-3.5 h-3.5 transition-transform duration-500 "+(_?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]})]}),w.length>0?e.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 3xl:grid-cols-6 gap-4",children:w.map(t=>e.jsx(i,{product:t,filters:f},t.id))}):!S&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-4 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(c,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:"Ничего не найдено"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-xs",children:"Попробуйте изменить запрос или сбросить фильтры"}),e.jsx("button",{onClick:()=>s.get("/"),className:"mt-6 px-6 py-2 bg-red-500 text-white rounded-xl text-sm font-bold hover:bg-red-600 transition-colors",children:"Сбросить все"})]}),e.jsx("div",{ref:W,className:"h-20 flex items-center justify-center mt-4",children:S&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})}),H&&e.jsx("button",{onClick:()=>{var e;null==(e=D.current)||e.scrollTo({top:0,behavior:"smooth"})},className:"fixed bottom-6 right-6 w-12 h-12 bg-red-500 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-red-600 transition-all z-50",children:e.jsx(l,{className:"w-5 h-5"})})]}),(v||b)&&e.jsx(m,{category:v,brand:b})]})]})},m=({category:r,brand:s})=>{if(s)return s.description?e.jsx("div",{className:"bg-gray-50 border-t border-gray-100 mt-12 py-12",children:e.jsx("div",{className:"container mx-auto px-4 max-w-4xl",children:e.jsx("section",{className:"prose prose-red prose-sm sm:prose-base max-w-none text-gray-600",dangerouslySetInnerHTML:{__html:s.description}})})}):null;if(!r)return null;const[n,o]=t.useState(r.description||""),[i,l]=t.useState(!1);return t.useEffect(()=>{o(r.description||"")},[r.id]),t.useEffect(()=>{const e=setTimeout(async()=>{const e=n||"",t=["Собакевич","Ноздрев","Чичиков","Lorem","ipsum"].some(t=>e.includes(t)),s=e.length<50&&e.length>0;if((t||s||!e)&&!i){l(!0);try{const e=await a.post(`/api/categories/${r.slug}/description/generate`);e.data.description&&o(e.data.description)}catch(c){}finally{l(!1)}}},1e3);return()=>clearTimeout(e)},[r.id,r.slug]),n||i?e.jsx("div",{className:"bg-gray-50 border-t border-gray-100 mt-12 py-12",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[i&&e.jsxs("div",{className:"space-y-4 animate-pulse max-w-2xl mx-auto",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-4/5"})]}),e.jsx("section",{className:"prose prose-red prose-sm sm:prose-base max-w-none text-gray-600 transition-opacity duration-1000 "+(i?"opacity-50 blur-sm":"opacity-100"),dangerouslySetInnerHTML:{__html:n}})]})}):null};d.layout=t=>e.jsx(r,{children:t,filters:t.props.filters});export{d as default};
