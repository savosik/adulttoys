import{jsx as e,jsxs as t,Fragment as r}from"react/jsx-runtime";import{useState as o,useCallback as n,useRef as a}from"react";import{Link as l}from"@inertiajs/react";import{Swiper as i,SwiperSlide as s}from"swiper/react";import{Pagination as c,Navigation as d}from"swiper/modules";import{u as g}from"./useStore-Bfof7OyV.js";import{g as h,a as m}from"./imageHelper-Mbc89JsA.js";import u from"react-easy-crop";import p from"axios";/* empty css                   */const x=({isOpen:a,onClose:l,imageUrl:i,categoryId:s,categorySlug:c})=>{const[d,g]=o({x:0,y:0}),[h,m]=o(1),[x,f]=o(null),[b,w]=o(!1),[y,v]=o(null),[k,N]=o(""),C=n((e,t)=>{f(t)},[]),_=()=>{l(),v(null),g({x:0,y:0}),m(1)};return a?e("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:_,children:t("div",{className:"bg-gray-900 rounded-2xl shadow-2xl max-w-lg w-full mx-4 overflow-hidden",onClick:e=>e.stopPropagation(),children:[t("div",{className:"p-4 border-b border-gray-800 flex items-center justify-between",children:[e("h3",{className:"text-lg font-bold text-white",children:"Выбор области иконки"}),e("button",{onClick:_,className:"w-8 h-8 rounded-lg bg-gray-800 hover:bg-gray-700 flex items-center justify-center transition-colors",children:e("svg",{className:"w-4 h-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e("div",{className:"relative h-80 bg-white",children:e(u,{image:i,crop:d,zoom:h,minZoom:.3,maxZoom:3,aspect:1,onCropChange:g,onCropComplete:C,onZoomChange:m,cropShape:"rect",showGrid:!0,restrictPosition:!1,style:{containerStyle:{background:"#ffffff"},cropAreaStyle:{border:"2px solid #ef4444"},mediaStyle:{background:"#ffffff"}}})}),t("div",{className:"p-4 border-t border-gray-800",children:[t("div",{className:"flex items-center gap-3",children:[e("svg",{className:"w-5 h-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"})}),e("input",{type:"range",min:.3,max:3,step:.05,value:h,onChange:e=>m(Number(e.target.value)),className:"flex-1 h-2 bg-gray-700 rounded-full appearance-none cursor-pointer accent-red-500"}),e("svg",{className:"w-5 h-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"})})]}),e("p",{className:"text-center text-xs text-gray-500 mt-2",children:"Перетащите изображение и используйте слайдер для масштабирования"})]}),y&&t("div",{className:"mx-4 mb-4 p-3 rounded-lg text-sm font-medium text-center "+("success"===y?"bg-green-900/50 text-green-400 border border-green-800":"bg-red-900/50 text-red-400 border border-red-800"),children:["success"===y?"✓ ":"✕ ",k]}),t("div",{className:"p-4 border-t border-gray-800 flex gap-3",children:[e("button",{onClick:_,className:"flex-1 py-3 px-4 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-xl font-medium transition-colors",children:"Отмена"}),e("button",{onClick:async()=>{var e,t;if(x){w(!0),v(null);try{const e=await p.post("/api/category/set-icon",{image_url:i,crop_data:x,zoom_level:h,category_id:s||null,category_slug:c||null});e.data.success&&(v("success"),N(e.data.message),setTimeout(()=>{l(),v(null),g({x:0,y:0}),m(1)},1500))}catch(r){v("error"),N((null==(t=null==(e=r.response)?void 0:e.data)?void 0:t.message)||"Произошла ошибка")}finally{w(!1)}}},disabled:b||!x,className:"flex-1 py-3 px-4 bg-red-500 hover:bg-red-600 text-white rounded-xl font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:b?e("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):t(r,{children:[e("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"Установить иконку"]})})]})]})}):null},f=t=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:e("path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"})}),b=r=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...r,children:[e("circle",{cx:"8",cy:"21",r:"1"}),e("circle",{cx:"19",cy:"21",r:"1"}),e("path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"})]}),w=t=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:e("path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"})}),y=r=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...r,children:[e("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),e("circle",{cx:"12",cy:"13",r:"3"})]}),v=({product:n,filters:u={}})=>{const p=g(e=>e.addToCart),v=g(e=>e.incrementCartQuantity),k=g(e=>e.decrementCartQuantity),N=g(e=>e.toggleFavorite),C=g(e=>e.favorites),_=e=>C.some(t=>t.id===e),j=g(e=>e.toggleChatQueue),L=g(e=>e.cart),S=g(e=>e.chatQueue),[M,P]=o(!1),[B,I]=o(null);a(null);const z=(()=>{if("undefined"==typeof window)return!1;const e=new URLSearchParams(window.location.search).get("edit_icons");return"1"===e?(localStorage.setItem("edit_icons_mode","1"),!0):"0"===e?(localStorage.removeItem("edit_icons_mode"),!1):"1"===localStorage.getItem("edit_icons_mode")})(),W=e=>{e.preventDefault(),e.stopPropagation(),n.stock>0&&p(n)},D=e=>{e.preventDefault(),e.stopPropagation(),j(n)},U=[n.image_main,...(n.additional_images||[]).map(e=>e.url)].filter(Boolean);0===U.length&&U.push("https://placehold.co/400x400/e5e7eb/6b7280?text=No+Image");const H=(()=>{const e=new URLSearchParams;u.category&&e.set("category",u.category),u.sub_category&&e.set("sub_category",u.sub_category),u.brand&&e.set("brand",u.brand),u.search&&e.set("search",u.search),u.sort&&e.set("sort",u.sort);const t=e.toString();return`/product/${n.slug}${t?"?"+t:""}`})();return t(r,{children:[t(l,{href:H,className:"bg-white rounded-2xl overflow-hidden shadow-sm group border border-gray-100 flex flex-col cursor-pointer hover:shadow-md transition-shadow",children:[t("div",{className:"relative aspect-[2/3] overflow-hidden bg-gray-50",children:[e(i,{modules:[c,d],pagination:{clickable:!0},navigation:!0,className:"h-full w-full product-swiper",children:U.map((r,o)=>e(s,{children:t("div",{className:"relative w-full h-full",children:[e("img",{...h(m(r),`${n.name} - ${o+1}`,{loading:"lazy",width:400,height:600,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"})}),z&&e("button",{onClick:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),I(t),P(!0)})(e,r),className:"absolute top-2 right-2 w-8 h-8 bg-black/50 hover:bg-black/70 text-white rounded-lg flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-20",title:"Установить как иконку категории",children:e(y,{className:"w-4 h-4"})})]})},o))}),n.old_price&&t("div",{className:"absolute top-2 left-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-lg z-10",children:["-",Math.round((n.old_price-n.price)/n.old_price*100),"%"]})]}),t("div",{className:"p-3",children:[e("h3",{className:"font-medium text-gray-900 text-sm mb-1 line-clamp-2 min-h-[2.5rem]",children:n.name}),t("div",{className:"flex items-center gap-1 mb-2",children:[e("span",{className:"text-yellow-500 text-sm",children:"★"}),e("span",{className:"text-xs text-gray-600",children:Number(n.reviews_avg_rating||0).toFixed(1)}),t("span",{className:"text-xs text-gray-400",children:["(",n.reviews_count||0,")"]})]}),t("div",{className:"flex items-end gap-2 mb-3",children:[t("span",{className:"text-lg font-bold text-gray-900",children:[new Intl.NumberFormat("ru-RU").format(n.price)," BYN"]}),n.old_price&&t("span",{className:"text-xs text-gray-400 line-through mb-0.5",children:[new Intl.NumberFormat("ru-RU").format(n.old_price)," BYN"]})]}),t("div",{className:"flex gap-2",children:[e("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),N(n)},className:"flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center transition-colors "+(_(n.id)?"bg-red-50 border border-red-200":"bg-gray-100 hover:bg-gray-200"),children:e(f,{className:"w-5 h-5 transition-all "+(_(n.id)?"fill-red-500 stroke-red-500":"text-gray-600")})}),(()=>{const o=L.find(e=>e.id===n.id);return o?t("div",{className:"flex-1 flex items-center gap-1 bg-green-600 rounded-xl overflow-hidden",children:[e("button",{onClick:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),k(t)})(e,n.id),className:"w-10 h-10 flex items-center justify-center hover:bg-green-700 transition-colors text-white font-bold text-lg",children:"−"}),e("div",{className:"flex-1 text-center text-white font-bold text-sm",children:o.quantity}),e("button",{onClick:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),v(t)})(e,n.id),className:"w-10 h-10 flex items-center justify-center hover:bg-green-700 transition-colors text-white font-bold text-lg",children:"+"})]}):e("button",{onClick:W,className:"flex-1 py-2.5 rounded-xl font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 "+(n.stock<=0?"bg-gray-200 text-gray-500":"bg-red-500 hover:bg-red-600 text-white"),disabled:n.stock<=0,children:n.stock>0?t(r,{children:[e(b,{className:"w-4 h-4"}),t("span",{className:"text-sm",children:[e("span",{className:"xs:hidden",children:"купить"}),e("span",{className:"hidden xs:inline",children:(new Date).getHours()<19?"сегодня":"завтра"})]})]}):"Нет в наличии"})})(),(()=>{const t=S.some(e=>e.id===n.id);return e("button",{onClick:D,className:"flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center transition-colors "+(t?"bg-red-50 border border-red-200":"bg-gray-100 hover:bg-gray-200"),children:e(w,{className:"w-5 h-5 transition-all "+(t?"fill-red-500 stroke-red-500":"text-gray-600")})})})()]})]})]}),e(x,{isOpen:M,onClose:()=>P(!1),imageUrl:B,...(()=>{const e=new URLSearchParams(window.location.search).get("sub_category");if(e){const t=e.split(",")[0];return{categoryId:parseInt(t,10),categorySlug:null}}const t=window.location.pathname.match(/\/category\/([^/]+)/);return t?{categoryId:null,categorySlug:t[1]}:{categoryId:null,categorySlug:null}})()})]})};export{v as P};
