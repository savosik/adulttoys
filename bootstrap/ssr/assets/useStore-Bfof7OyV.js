import{create as e}from"zustand";import{persist as t}from"zustand/middleware";const r=e(t((e,t)=>({cart:[],deliveryMethod:"pickup",courierDelivery:{address:"",phone:"",mapLat:null,mapLng:null,comment:""},courierDeliveryErrors:{address:"",phone:""},postDelivery:{postalCode:"",region:"",city:"",house:"",apartment:"",phone:""},postDeliveryErrors:{postalCode:"",region:"",city:"",house:"",apartment:"",phone:""},favorites:[],chatQueue:[],notification:null,addToCart:r=>{const{cart:o}=t(),i=o.find(e=>e.id===r.id);e(i?{cart:o.map(e=>e.id===r.id?{...e,quantity:e.quantity+1}:e)}:{cart:[...o,{...r,quantity:1}]})},removeFromCart:r=>{e({cart:t().cart.filter(e=>e.id!==r)})},updateCartQuantity:(r,o)=>{o<=0?t().removeFromCart(r):e({cart:t().cart.map(e=>e.id===r?{...e,quantity:o}:e)})},incrementCartQuantity:e=>{const r=t().cart.find(t=>t.id===e);r&&t().updateCartQuantity(e,r.quantity+1)},decrementCartQuantity:e=>{const r=t().cart.find(t=>t.id===e);r&&t().updateCartQuantity(e,r.quantity-1)},clearCart:()=>{e({cart:[]})},getCartTotal:()=>t().cart.reduce((e,t)=>e+t.price*t.quantity,0),getCartCount:()=>t().cart.reduce((e,t)=>e+t.quantity,0),addToFavorites:r=>{const{favorites:o}=t();o.find(e=>e.id===r.id)||e({favorites:[...o,r]})},removeFromFavorites:r=>{e({favorites:t().favorites.filter(e=>e.id!==r)})},toggleFavorite:e=>{const{favorites:r}=t();r.find(t=>t.id===e.id)?t().removeFromFavorites(e.id):t().addToFavorites(e)},isFavorite:e=>t().favorites.some(t=>t.id===e),getFavoritesCount:()=>t().favorites.length,clearFavorites:()=>{e({favorites:[]})},addToChatQueue:r=>{const{chatQueue:o}=t();o.find(e=>e.id===r.id)||e({chatQueue:[...o,r]})},removeFromChatQueue:r=>{e({chatQueue:t().chatQueue.filter(e=>e.id!==r)})},toggleChatQueue:e=>{const{chatQueue:r}=t();r.find(t=>t.id===e.id)?t().removeFromChatQueue(e.id):t().addToChatQueue(e)},clearChatQueue:()=>{e({chatQueue:[]})},getChatQueueCount:()=>t().chatQueue.length,showNotification:(t,r="success")=>{e({notification:{message:t,type:r,id:Date.now()}})},setDeliveryMethod:t=>{e({deliveryMethod:t})},getDeliveryCost:()=>{const{deliveryMethod:e}=t(),r=t().getCartTotal();switch(e){case"pickup":default:return 0;case"courier":return r>=100?0:15;case"post":return r>=200?0:20}},getOrderTotal:()=>t().getCartTotal()+t().getDeliveryCost(),setCourierDeliveryData:r=>{const o={...t().courierDelivery,...r};e({courierDelivery:o});const i={...t().courierDeliveryErrors};if("address"in r&&(!r.address||r.address.trim().length<10?i.address="Адрес должен содержать минимум 10 символов":i.address=""),"phone"in r){const e=/^\+375\s?\(?\d{2}\)?\s?\d{3}[-\s]?\d{2}[-\s]?\d{2}$/;r.phone?e.test(r.phone)?i.phone="":i.phone="Формат: +375 (29) 123-45-67":i.phone="Телефон обязателен для заполнения"}e({courierDeliveryErrors:i})},validateCourierDelivery:()=>{const{courierDelivery:r}=t(),o={};(!r.address||r.address.trim().length<10)&&(o.address="Адрес должен содержать минимум 10 символов");return r.phone?/^\+375\s?\(?\d{2}\)?\s?\d{3}[-\s]?\d{2}[-\s]?\d{2}$/.test(r.phone)||(o.phone="Формат: +375 (29) 123-45-67"):o.phone="Телефон обязателен для заполнения",e({courierDeliveryErrors:o}),0===Object.keys(o).length},clearCourierDeliveryData:()=>{e({courierDelivery:{address:"",phone:"",mapLat:null,mapLng:null,comment:""},courierDeliveryErrors:{address:"",phone:""}})},setPostDeliveryData:r=>{const o={...t().postDelivery,...r};e({postDelivery:o});const i={...t().postDeliveryErrors};if("postalCode"in r){const e=/^\d{6}$/;r.postalCode?e.test(r.postalCode)?i.postalCode="":i.postalCode="Индекс должен содержать 6 цифр":i.postalCode="Индекс обязателен"}if("region"in r&&(!r.region||r.region.trim().length<3?i.region="Укажите район (минимум 3 символа)":i.region=""),"city"in r&&(!r.city||r.city.trim().length<2?i.city="Укажите населенный пункт (минимум 2 символа)":i.city=""),"house"in r&&(r.house&&0!==r.house.trim().length?i.house="":i.house="Укажите номер дома"),"apartment"in r&&(r.apartment&&0!==r.apartment.trim().length?i.apartment="":i.apartment="Укажите номер квартиры"),"phone"in r){const e=/^\+375\s?\(?\d{2}\)?\s?\d{3}[-\s]?\d{2}[-\s]?\d{2}$/;r.phone?e.test(r.phone)?i.phone="":i.phone="Формат: +375 (29) 123-45-67":i.phone="Телефон обязателен"}e({postDeliveryErrors:i})},validatePostDelivery:()=>{const{postDelivery:r}=t(),o={};r.postalCode?/^\d{6}$/.test(r.postalCode)||(o.postalCode="Индекс должен содержать 6 цифр"):o.postalCode="Индекс обязателен",(!r.region||r.region.trim().length<3)&&(o.region="Укажите район (минимум 3 символа)"),(!r.city||r.city.trim().length<2)&&(o.city="Укажите населенный пункт (минимум 2 символа)"),r.house&&0!==r.house.trim().length||(o.house="Укажите номер дома"),r.apartment&&0!==r.apartment.trim().length||(o.apartment="Укажите номер квартиры");return r.phone?/^\+375\s?\(?\d{2}\)?\s?\d{3}[-\s]?\d{2}[-\s]?\d{2}$/.test(r.phone)||(o.phone="Формат: +375 (29) 123-45-67"):o.phone="Телефон обязателен",e({postDeliveryErrors:o}),0===Object.keys(o).length},clearPostDeliveryData:()=>{e({postDelivery:{postalCode:"",region:"",city:"",house:"",apartment:"",phone:""},postDeliveryErrors:{postalCode:"",region:"",city:"",house:"",apartment:"",phone:""}})}}),{name:"ecom-storage",partialize:e=>({cart:e.cart,favorites:e.favorites,chatQueue:e.chatQueue,deliveryMethod:e.deliveryMethod,courierDelivery:e.courierDelivery,postDelivery:e.postDelivery})}));export{r as u};
