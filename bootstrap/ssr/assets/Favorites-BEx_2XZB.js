import{jsxs as e,jsx as t,Fragment as r}from"react/jsx-runtime";import{useState as n,useRef as a,useEffect as l}from"react";import{M as i}from"./MainLayout-Dw2FxwLe.js";import{router as o,Head as s,Link as c}from"@inertiajs/react";import{Swiper as d,SwiperSlide as h}from"swiper/react";import{Pagination as m,Navigation as u}from"swiper/modules";import g from"axios";import{u as p}from"./useStore-DzKPy6C4.js";/* empty css                   */import"zustand";import"zustand/middleware";const x=e=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:t("path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"})}),f=r=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...r,children:[t("circle",{cx:"8",cy:"21",r:"1"}),t("circle",{cx:"19",cy:"21",r:"1"}),t("path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"})]}),w=e=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:t("path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"})}),v=r=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...r,children:[t("circle",{cx:"11",cy:"11",r:"8"}),t("path",{d:"m21 21-4.3-4.3"})]}),b=r=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...r,children:[t("path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}),t("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),t("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]}),y=r=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...r,children:[t("path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"}),t("path",{d:"M7 7h.01"})]}),N=r=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...r,children:[t("path",{d:"m21 16-4 4-4-4"}),t("path",{d:"M17 20V4"}),t("path",{d:"m3 8 4-4 4 4"}),t("path",{d:"M7 4v16"})]}),k=()=>{const k=p(e=>e.addToCart),C=p(e=>e.incrementCartQuantity),j=p(e=>e.decrementCartQuantity),_=p(e=>e.toggleFavorite),L=p(e=>e.isFavorite),M=p(e=>e.toggleChatQueue),B=p(e=>e.cart),D=p(e=>e.chatQueue),F=p(e=>e.favorites),R=p(e=>e.clearFavorites),[P,W]=n("latest"),[z,S]=n(!1),I=a(null),Q=[...F].sort((e,t)=>{switch(P){case"price_asc":return e.price-t.price;case"price_desc":return t.price-e.price;case"name_asc":return e.name.localeCompare(t.name);case"name_desc":return t.name.localeCompare(e.name);default:return 0}}),[T,U]=n(""),[Z,$]=n({products:[],categories:[]}),[A,H]=n(!1),[Y,q]=n(!1),[E,V]=n(!1),G=a(null),J=a(null);l(()=>{const e=e=>{G.current&&!G.current.contains(e.target)&&H(!1),I.current&&!I.current.contains(e.target)&&S(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),l(()=>{const e=setTimeout(()=>{T.length>=2?g.get(`/search/suggestions?q=${T}`).then(e=>{$(e.data),H(!0)}):($({products:[],categories:[]}),H(!1))},300);return()=>clearTimeout(e)},[T]),l(()=>{if("undefined"!=typeof window&&("webkitSpeechRecognition"in window||"SpeechRecognition"in window)){const e=window.SpeechRecognition||window.webkitSpeechRecognition;J.current=new e,J.current.continuous=!1,J.current.interimResults=!1,J.current.lang="ru-RU",J.current.onresult=e=>{const t=e.results[0][0].transcript;U(t),q(!1),o.get("/catalog",{search:t})},J.current.onerror=()=>q(!1),J.current.onend=()=>q(!1)}return()=>{var e;return null==(e=J.current)?void 0:e.stop()}},[]);const K=e=>{null==e||e.preventDefault(),T.trim()&&o.get("/catalog",{search:T})};return e(i,{children:[t(s,{title:"Избранное"}),e("div",{className:"bg-white shadow-sm flex-shrink-0 sticky top-0 z-20",children:[t("div",{className:"px-4 py-3",children:e("div",{className:"flex items-center gap-4",children:[e("div",{className:"flex-1 relative",ref:G,children:[e("form",{onSubmit:K,className:"relative",children:[t(v,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),t("input",{type:"text",placeholder:"Поиск товаров...",value:T,onChange:e=>U(e.target.value),onFocus:()=>T.length>=2&&H(!0),className:"w-full pl-9 pr-10 py-2 bg-gray-100 rounded-xl border-0 focus:ring-2 focus:ring-red-400 focus:bg-white transition-all text-sm"}),t("button",{type:"submit",className:"hidden","aria-hidden":"true"}),t("button",{type:"button",onClick:()=>{if(!J.current)return alert("Голосовой ввод не поддерживается");Y?J.current.stop():(J.current.start(),q(!0))},className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 rounded-full transition-all "+(Y?"bg-red-500 text-white animate-pulse":"text-gray-400 hover:text-red-600 hover:bg-gray-200"),children:t(b,{className:"w-4 h-4"})})]}),A&&(Z.products.length>0||Z.categories.length>0)&&e("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-2xl border border-gray-100 z-[9999] animate-in fade-in slide-in-from-top-2 duration-200 max-h-[70vh] flex flex-col overflow-hidden",children:[e("div",{className:"overflow-y-auto flex-1",children:[Z.categories.length>0&&e("div",{className:"p-2",children:[t("div",{className:"px-3 py-1 text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Категории"}),Z.categories.map(r=>e(c,{href:r.url,onClick:()=>H(!1),className:"flex items-center gap-3 px-3 py-2 hover:bg-red-50 rounded-lg transition-colors group",children:[r.icon_url?t("img",{src:r.icon_url,alt:"",className:"w-4 h-4 object-contain flex-shrink-0"}):t(y,{className:"w-4 h-4 text-red-500"}),t("span",{className:"text-sm font-medium text-gray-700",children:r.name})]},r.id))]}),Z.products.length>0&&e("div",{className:"p-2 border-t border-gray-50",children:[t("div",{className:"px-3 py-1 text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Товары"}),Z.products.map(r=>{const n={id:r.id,name:r.name,price:r.price,image_main:r.image,stock:1},a=L(r.id);return e("div",{className:"flex items-center gap-2 px-3 py-2 hover:bg-red-50 rounded-lg transition-colors group",children:[e(c,{href:r.url,onClick:()=>H(!1),className:"flex items-center gap-3 flex-1 min-w-0",children:[t("div",{className:"w-10 h-10 bg-gray-50 rounded-lg overflow-hidden border border-gray-100 flex-shrink-0",children:t("img",{src:r.image||"https://placehold.co/100x100?text=No+Image",alt:"",className:"w-full h-full object-cover"})}),e("div",{className:"flex-1 min-w-0",children:[t("div",{className:"text-sm font-medium text-gray-900 truncate",children:r.name}),e("div",{className:"flex items-center gap-2 mt-0.5",children:[e("div",{className:"text-xs text-red-600 font-bold",children:[new Intl.NumberFormat("ru-RU").format(r.price)," BYN"]}),r.reviews_count>0&&e("div",{className:"flex items-center gap-0.5 text-[10px] text-gray-400",children:[t("span",{className:"text-yellow-500",children:"★"}),t("span",{children:Number(r.reviews_avg_rating).toFixed(1)}),e("span",{children:["(",r.reviews_count,")"]})]})]})]})]}),t("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),_(n)},className:"w-8 h-8 rounded-lg flex items-center justify-center transition-colors "+(a?"bg-red-50":"bg-gray-100 hover:bg-gray-200"),children:t(x,{className:"w-4 h-4 "+(a?"fill-red-500 text-red-500":"text-gray-600")})})]},r.id)})]})]}),t("button",{onClick:K,className:"w-full p-3 bg-red-50 text-center text-xs font-bold text-red-600 hover:bg-red-100 transition-colors border-t border-gray-100",children:"Показать все результаты"})]})]}),e("div",{className:"relative flex-shrink-0",ref:I,children:[t("button",{onClick:()=>S(!z),className:"p-2 rounded-lg transition-colors "+(z?"bg-gray-200":"hover:bg-gray-100"),children:t(N,{className:"w-6 h-6 text-gray-700"})}),z&&e("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-xl border border-gray-100 z-50 py-2 animate-in fade-in slide-in-from-top-2 duration-200",children:[t("div",{className:"px-4 py-2 border-b border-gray-50 mb-1",children:t("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Сортировка"})}),[{label:"Сначала новые",value:"latest"},{label:"Дешевле",value:"price_asc"},{label:"Дороже",value:"price_desc"},{label:"По названию (А-Я)",value:"name_asc"},{label:"По названию (Я-А)",value:"name_desc"}].map(r=>e("button",{onClick:()=>{return e=r.value,W(e),void S(!1);var e},className:"w-full px-4 py-2.5 text-left text-sm transition-colors flex items-center justify-between "+(P===r.value?"text-red-700 font-bold bg-red-50":"text-gray-600 hover:bg-gray-50"),children:[t("span",{children:r.label}),P===r.value&&t("div",{className:"w-1.5 h-1.5 rounded-full bg-red-500"})]},r.value))]})]})]})}),e("div",{className:"px-4 py-3 border-t border-gray-50 flex items-center justify-between",children:[e("div",{children:[t("h1",{className:"text-xl font-bold text-gray-900",children:"Избранное"}),F.length>0&&e("p",{className:"text-sm text-gray-500 mt-0.5",children:[F.length," ",1===F.length?"товар":F.length>1&&F.length<5?"товара":"товаров"]})]}),F.length>0&&t("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),E?(R(),V(!1)):(V(!0),setTimeout(()=>V(!1),3e3))},className:"text-sm transition-colors font-medium px-3 py-1 rounded-lg "+(E?"bg-red-500 text-white hover:bg-red-600":"text-gray-400 hover:text-red-500"),children:E?"Уверены? Нажмите ещё раз":"Очистить всё"})]})]}),t("main",{className:"flex-1 overflow-y-auto content-scroll",children:t("div",{className:"p-4",children:0===F.length?e("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[t("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6",children:t(x,{className:"w-12 h-12 text-gray-400"})}),t("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Список избранного пуст"}),t("p",{className:"text-gray-500 text-center mb-6 max-w-sm",children:"Добавляйте понравившиеся товары, чтобы не потерять их"}),t(c,{href:"/catalog",className:"px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-xl font-medium transition-colors",children:"Перейти в каталог"})]}):t("div",{className:"grid grid-cols-1 xs:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4",children:Q.map(n=>{const a=[n.image_main,...(n.additional_images||[]).map(e=>e.url)].filter(Boolean);return 0===a.length&&a.push("https://placehold.co/400x400/e5e7eb/6b7280?text=No+Image"),e(c,{href:`/product/${n.id}`,className:"bg-white rounded-2xl overflow-hidden shadow-sm group border border-gray-100 flex flex-col cursor-pointer hover:shadow-md transition-shadow",children:[e("div",{className:"relative aspect-[2/3] overflow-hidden bg-gray-50",children:[t(d,{modules:[m,u],pagination:{clickable:!0},navigation:!0,className:"h-full w-full product-swiper",children:a.map((e,r)=>t(h,{children:t("img",{src:e,alt:`${n.name} - ${r+1}`,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"})},r))}),n.old_price&&e("div",{className:"absolute top-2 left-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-lg z-10",children:["-",Math.round((n.old_price-n.price)/n.old_price*100),"%"]})]}),e("div",{className:"p-3",children:[t("h3",{className:"font-medium text-gray-900 text-sm mb-1 line-clamp-2 min-h-[2.5rem]",children:n.name}),e("div",{className:"flex items-center gap-1 mb-2",children:[t("span",{className:"text-yellow-500 text-sm",children:"★"}),t("span",{className:"text-xs text-gray-600",children:Number(n.reviews_avg_rating||0).toFixed(1)}),e("span",{className:"text-xs text-gray-400",children:["(",n.reviews_count||0,")"]})]}),e("div",{className:"flex items-end gap-2 mb-3",children:[e("span",{className:"text-lg font-bold text-gray-900",children:[new Intl.NumberFormat("ru-RU").format(n.price)," BYN"]}),n.old_price&&e("span",{className:"text-xs text-gray-400 line-through mb-0.5",children:[new Intl.NumberFormat("ru-RU").format(n.old_price)," BYN"]})]}),e("div",{className:"flex gap-2",children:[t("button",{onClick:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),_(t)})(e,n),className:"flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center transition-colors bg-red-50 border border-red-200",children:t(x,{className:"w-5 h-5 transition-all fill-red-500 stroke-red-500"})}),(()=>{const a=B.find(e=>e.id===n.id);return a?e("div",{className:"flex-1 flex items-center gap-1 bg-green-600 rounded-xl overflow-hidden",children:[t("button",{onClick:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),j(t)})(e,n.id),className:"w-10 h-10 flex items-center justify-center hover:bg-green-700 transition-colors text-white font-bold text-lg",children:"−"}),t("div",{className:"flex-1 text-center text-white font-bold text-sm",children:a.quantity}),t("button",{onClick:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),C(t)})(e,n.id),className:"w-10 h-10 flex items-center justify-center hover:bg-green-700 transition-colors text-white font-bold text-lg",children:"+"})]}):t("button",{onClick:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),t.stock>0&&k(t)})(e,n),className:"flex-1 py-2.5 rounded-xl font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 "+(n.stock<=0?"bg-gray-200 text-gray-500":"bg-red-500 hover:bg-red-600 text-white"),disabled:n.stock<=0,children:n.stock>0?e(r,{children:[t(f,{className:"w-4 h-4"}),e("span",{className:"text-sm",children:[t("span",{className:"xs:hidden",children:"купить"}),t("span",{className:"hidden xs:inline",children:(new Date).getHours()<19?"сегодня":"завтра"})]})]}):"Нет в наличии"})})(),(()=>{const e=D.some(e=>e.id===n.id);return t("button",{onClick:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),M(t)})(e,n),className:"flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center transition-colors "+(e?"bg-red-50 border border-red-200":"bg-gray-100 hover:bg-gray-200"),children:t(w,{className:"w-5 h-5 transition-all "+(e?"fill-red-500 stroke-red-500":"text-gray-600")})})})()]})]})]},n.id)})})})})]})};export{k as default};
