import{jsx as e,jsxs as t,Fragment as r}from"react/jsx-runtime";import{useState as n,useEffect as o,useRef as a}from"react";import{M as s}from"./MainLayout-Dw2FxwLe.js";import{router as i,Head as l,Link as c}from"@inertiajs/react";import{Swiper as d,SwiperSlide as m}from"swiper/react";import{Pagination as h,Navigation as g}from"swiper/modules";import{u}from"./useStore-DzKPy6C4.js";import{g as p,a as x}from"./imageHelper-DZyBmji8.js";/* empty css                   */import"axios";import"zustand";import"zustand/middleware";const f=t=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:e("path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"})}),b=r=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...r,children:[e("circle",{cx:"8",cy:"21",r:"1"}),e("circle",{cx:"19",cy:"21",r:"1"}),e("path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"})]}),w=t=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:e("path",{d:"m18 15-6-6-6 6"})}),v=t=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:e("path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"})}),y=r=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...r,children:[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"m21 21-4.3-4.3"})]}),N=N=>{var k,_,j,C,L,S;const{products:B,categories:M,subCategories:D=[],filters:$,currentCategory:A=null}=N,[W,I]=n((null==B?void 0:B.data)||[]),[P,z]=n(!1),[F,H]=n(!1),[Q,T]=n(new Set($.sub_category?String($.sub_category).split(","):[]));o(()=>{T(new Set($.sub_category?String($.sub_category).split(","):[]))},[$.sub_category]);const[R,U]=n($.search||""),[E,Y]=n({products:[],categories:[]}),[Z,q]=n(!1),[O,G]=n(!1);a(null),a(null);const J=a(null),K=a(null),[V,X]=n(!1);$.sort;const ee=u(e=>e.addToCart),te=u(e=>e.incrementCartQuantity),re=u(e=>e.decrementCartQuantity),ne=u(e=>e.toggleFavorite),oe=u(e=>e.favorites),ae=e=>oe.some(t=>t.id===e),se=u(e=>e.toggleChatQueue),ie=u(e=>e.cart),le=u(e=>e.chatQueue);o(()=>{B&&(1===B.current_page?I(B.data||[]):I(e=>[...e,...B.data||[]]),z(!1))},[B]),o(()=>{if(!B)return;const e=new IntersectionObserver(e=>{e[0].isIntersecting&&B.next_page_url&&!P&&(z(!0),i.get(B.next_page_url,{},{preserveState:!0,preserveScroll:!0,only:["products"]}))},{threshold:.1});return J.current&&e.observe(J.current),()=>e.disconnect()},[null==B?void 0:B.next_page_url,P]),o(()=>{const e=()=>{if(K.current){const e=K.current.scrollTop;X(e>500)}},t=K.current;if(t)return t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)},[]);return e(s,{children:t(r,{children:[t(l,{title:(null==(k=N.meta)?void 0:k.title)||"Каталог товаров",children:[e("meta",{name:"description",content:(null==(_=N.meta)?void 0:_.description)||"Каталог товаров A-toys"}),e("meta",{property:"og:type",content:"website"}),e("meta",{property:"og:title",content:(null==(j=N.meta)?void 0:j.title)||"Каталог товаров"}),e("meta",{property:"og:description",content:(null==(C=N.meta)?void 0:C.description)||"Каталог товаров A-toys"}),e("meta",{name:"twitter:card",content:"summary"}),e("meta",{name:"twitter:title",content:(null==(L=N.meta)?void 0:L.title)||"Каталог товаров"}),e("meta",{name:"twitter:description",content:(null==(S=N.meta)?void 0:S.description)||"Каталог товаров A-toys"})]}),t("main",{ref:K,className:"relative",children:[t("div",{className:"p-4",children:[e("h1",{className:"sr-only",children:A?A.name:$.search?`Поиск: ${$.search}`:"Каталог товаров"}),D.length>0&&t("div",{className:"mb-6",children:[e("div",{className:"flex flex-wrap gap-2",children:D.map((r,n)=>{const o=Q.has(String(r.id));return t("button",{onClick:()=>(e=>{const t=String(e),r=new Set(Q);r.has(t)?r.delete(t):r.add(t),T(r);const n=Array.from(r).join(","),o=$.category?`/category/${$.category}`:"/";i.get(o,{...$,category:void 0,sub_category:n||void 0},{preserveState:!0,preserveScroll:!0,replace:!0})})(r.id),className:`px-3 py-1.5 rounded-lg text-[9px] font-bold transition-all border text-left leading-none items-center gap-1.5 break-words flex-shrink-0 max-w-[180px] sm:max-w-none ${!F&&n>=5?"hidden":"flex"} ${o?"bg-red-700 text-white border-red-700 shadow-sm":"bg-white border-gray-200 text-gray-500 hover:border-red-300"}`,children:[e("span",{children:r.name}),o&&e("svg",{className:"w-2.5 h-2.5 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})]},r.id)})}),D.length>5&&t("button",{onClick:()=>H(!F),className:"w-full mt-4 py-2 bg-gray-50/50 rounded-xl text-red-500 text-[10px] font-bold uppercase tracking-widest flex items-center justify-center gap-2 hover:bg-gray-100 hover:text-red-700 transition-all border border-transparent hover:border-gray-200",children:[e("span",{children:F?"Скрыть лишнее":`Все подкатегории (${D.length})`}),e("svg",{className:"w-3.5 h-3.5 transition-transform duration-500 "+(F?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]})]}),W.length>0?e("div",{className:"grid grid-cols-1 xs:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 3xl:grid-cols-6 gap-4",children:W.map(n=>{const o=[n.image_main,...(n.additional_images||[]).map(e=>e.url)].filter(Boolean);0===o.length&&o.push("https://placehold.co/400x400/e5e7eb/6b7280?text=No+Image");const a=(()=>{const e=new URLSearchParams;$.category&&e.set("category",$.category),$.sub_category&&e.set("sub_category",$.sub_category),$.brand&&e.set("brand",$.brand),$.search&&e.set("search",$.search),$.sort&&e.set("sort",$.sort);const t=e.toString();return`/product/${n.slug}${t?"?"+t:""}`})();return t(c,{href:a,className:"bg-white rounded-2xl overflow-hidden shadow-sm group border border-gray-100 flex flex-col cursor-pointer hover:shadow-md transition-shadow",children:[t("div",{className:"relative aspect-[2/3] overflow-hidden bg-gray-50",children:[e(d,{modules:[h,g],pagination:{clickable:!0},navigation:!0,className:"h-full w-full product-swiper",children:o.map((t,r)=>e(m,{children:e("img",{...p(x(t),`${n.name} - ${r+1}`,{loading:"lazy",width:400,height:600,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"})})},r))}),n.old_price&&t("div",{className:"absolute top-2 left-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-lg z-10",children:["-",Math.round((n.old_price-n.price)/n.old_price*100),"%"]})]}),t("div",{className:"p-3",children:[e("h3",{className:"font-medium text-gray-900 text-sm mb-1 line-clamp-2 min-h-[2.5rem]",children:n.name}),t("div",{className:"flex items-center gap-1 mb-2",children:[e("span",{className:"text-yellow-500 text-sm",children:"★"}),e("span",{className:"text-xs text-gray-600",children:Number(n.reviews_avg_rating||0).toFixed(1)}),t("span",{className:"text-xs text-gray-400",children:["(",n.reviews_count||0,")"]})]}),t("div",{className:"flex items-end gap-2 mb-3",children:[t("span",{className:"text-lg font-bold text-gray-900",children:[new Intl.NumberFormat("ru-RU").format(n.price)," BYN"]}),n.old_price&&t("span",{className:"text-xs text-gray-400 line-through mb-0.5",children:[new Intl.NumberFormat("ru-RU").format(n.old_price)," BYN"]})]}),t("div",{className:"flex gap-2",children:[e("button",{onClick:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),ne(t)})(e,n),className:"flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center transition-colors "+(ae(n.id)?"bg-red-50 border border-red-200":"bg-gray-100 hover:bg-gray-200"),children:e(f,{className:"w-5 h-5 transition-all "+(ae(n.id)?"fill-red-500 stroke-red-500":"text-gray-600")})}),(()=>{const o=ie.find(e=>e.id===n.id);return o?t("div",{className:"flex-1 flex items-center gap-1 bg-green-600 rounded-xl overflow-hidden",children:[e("button",{onClick:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),re(t)})(e,n.id),className:"w-10 h-10 flex items-center justify-center hover:bg-green-700 transition-colors text-white font-bold text-lg",children:"−"}),e("div",{className:"flex-1 text-center text-white font-bold text-sm",children:o.quantity}),e("button",{onClick:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),te(t)})(e,n.id),className:"w-10 h-10 flex items-center justify-center hover:bg-green-700 transition-colors text-white font-bold text-lg",children:"+"})]}):e("button",{onClick:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),t.stock>0&&ee(t)})(e,n),className:"flex-1 py-2.5 rounded-xl font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 "+(n.stock<=0?"bg-gray-200 text-gray-500":"bg-red-500 hover:bg-red-600 text-white"),disabled:n.stock<=0,children:n.stock>0?t(r,{children:[e(b,{className:"w-4 h-4"}),t("span",{className:"text-sm",children:[e("span",{className:"xs:hidden",children:"купить"}),e("span",{className:"hidden xs:inline",children:(new Date).getHours()<19?"сегодня":"завтра"})]})]}):"Нет в наличии"})})(),(()=>{const t=le.some(e=>e.id===n.id);return e("button",{onClick:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),se(t)})(e,n),className:"flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center transition-colors "+(t?"bg-red-50 border border-red-200":"bg-gray-100 hover:bg-gray-200"),children:e(v,{className:"w-5 h-5 transition-all "+(t?"fill-red-500 stroke-red-500":"text-gray-600")})})})()]})]})]},n.id)})}):!P&&t("div",{className:"flex flex-col items-center justify-center py-20 px-4 text-center",children:[e("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e(y,{className:"w-10 h-10 text-gray-400"})}),e("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:"Ничего не найдено"}),e("p",{className:"text-sm text-gray-500 max-w-xs",children:"Попробуйте изменить запрос или сбросить фильтры"}),e("button",{onClick:()=>i.get("/"),className:"mt-6 px-6 py-2 bg-red-500 text-white rounded-xl text-sm font-bold hover:bg-red-600 transition-colors",children:"Сбросить все"})]}),e("div",{ref:J,className:"h-20 flex items-center justify-center mt-4",children:P&&t("div",{className:"flex gap-2",children:[e("div",{className:"w-2 h-2 bg-red-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e("div",{className:"w-2 h-2 bg-red-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e("div",{className:"w-2 h-2 bg-red-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})}),V&&e("button",{onClick:()=>{var e;null==(e=K.current)||e.scrollTo({top:0,behavior:"smooth"})},className:"fixed bottom-6 right-6 w-12 h-12 bg-red-500 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-red-600 transition-all z-50",children:e(w,{className:"w-5 h-5"})})]}),(null==A?void 0:A.description)&&e("div",{className:"bg-gray-50 border-t border-gray-100 mt-12 py-12",children:e("div",{className:"container mx-auto px-4 max-w-4xl",children:e("section",{className:"prose prose-red prose-sm sm:prose-base max-w-none text-gray-600",dangerouslySetInnerHTML:{__html:A.description}})})})]})]})})};export{N as default};
