import{jsxs as e,Fragment as t,jsx as r}from"react/jsx-runtime";import{useState as n,useEffect as o,useRef as i}from"react";import{M as a}from"./MainLayout-Cr78fusN.js";import{router as s,Head as l}from"@inertiajs/react";import{u as d}from"./useStore-Bfof7OyV.js";import{P as c}from"./ProductCard-DXJ-byb4.js";import"axios";import"@dnd-kit/core";import"@dnd-kit/sortable";import"@dnd-kit/utilities";import"zustand";import"zustand/middleware";import"swiper/react";import"swiper/modules";import"./imageHelper-Mbc89JsA.js";import"react-easy-crop";/* empty css                   */const m=e=>r("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:r("path",{d:"m18 15-6-6-6 6"})}),u=t=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[r("circle",{cx:"11",cy:"11",r:"8"}),r("path",{d:"m21 21-4.3-4.3"})]}),p=a=>{var p,g,h,x,v,y;const{products:b,categories:f,subCategories:w=[],filters:N,currentCategory:k=null,currentBrand:j=null}=a,[C,_]=n((null==b?void 0:b.data)||[]),[L,S]=n(!1),[M,$]=n(!1),[B,A]=n(new Set(N.sub_category?String(N.sub_category).split(","):[]));o(()=>{A(new Set(N.sub_category?String(N.sub_category).split(","):[]))},[N.sub_category]);const[Q,T]=n(N.search||""),[W,z]=n({products:[],categories:[]}),[D,I]=n(!1),[E,H]=n(!1);i(null),i(null);const P=i(null),F=i(null),[O,q]=n(!1);N.sort,d(e=>e.addToCart),d(e=>e.incrementCartQuantity),d(e=>e.decrementCartQuantity),d(e=>e.toggleFavorite),d(e=>e.favorites),d(e=>e.toggleChatQueue),d(e=>e.cart),d(e=>e.chatQueue),o(()=>{b&&(1===b.current_page?_(b.data||[]):_(e=>[...e,...b.data||[]]),S(!1))},[b]),o(()=>{if(!b)return;const e=new IntersectionObserver(e=>{e[0].isIntersecting&&b.next_page_url&&!L&&(S(!0),s.get(b.next_page_url,{},{preserveState:!0,preserveScroll:!0,only:["products"]}))},{threshold:.1});return P.current&&e.observe(P.current),()=>e.disconnect()},[null==b?void 0:b.next_page_url,L]),o(()=>{const e=()=>{if(F.current){const e=F.current.scrollTop;q(e>500)}},t=F.current;if(t)return t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)},[]);return e(t,{children:[e(l,{title:(null==(p=a.meta)?void 0:p.title)||"Каталог товаров",children:[r("meta",{name:"description",content:(null==(g=a.meta)?void 0:g.description)||"Каталог товаров A-toys"}),r("meta",{property:"og:type",content:"website"}),r("meta",{property:"og:title",content:(null==(h=a.meta)?void 0:h.title)||"Каталог товаров"}),r("meta",{property:"og:description",content:(null==(x=a.meta)?void 0:x.description)||"Каталог товаров A-toys"}),r("meta",{name:"twitter:card",content:"summary"}),r("meta",{name:"twitter:title",content:(null==(v=a.meta)?void 0:v.title)||"Каталог товаров"}),r("meta",{name:"twitter:description",content:(null==(y=a.meta)?void 0:y.description)||"Каталог товаров A-toys"})]}),e("main",{ref:F,className:"relative",children:[e("div",{className:"p-4",children:[r("h1",{className:"sr-only",children:k?k.name:j?`Товары бренда ${j.name}`:N.search?`Поиск: ${N.search}`:"Каталог товаров"}),j&&e("div",{className:"mb-6",children:[r("h2",{className:"text-2xl font-bold text-gray-900",children:j.name}),r("p",{className:"text-sm text-gray-500 mt-1",children:"Все товары бренда"})]}),w.length>0&&e("div",{className:"mb-6",children:[r("div",{className:"flex flex-wrap gap-2",children:w.map((t,n)=>{const o=B.has(String(t.id));return e("button",{onClick:()=>(e=>{const t=String(e),r=new Set(B);r.has(t)?r.delete(t):r.add(t),A(r);const n=Array.from(r).join(","),o=N.category?`/category/${N.category}`:"/";s.get(o,{...N,category:void 0,sub_category:n||void 0},{preserveState:!0,preserveScroll:!0,replace:!0})})(t.id),className:`px-3 py-1.5 rounded-lg text-[9px] font-bold transition-all border text-left leading-none items-center gap-1.5 break-words flex-shrink-0 max-w-[180px] sm:max-w-none ${!M&&n>=5?"hidden":"flex"} ${o?"bg-red-700 text-white border-red-700 shadow-sm":"bg-white border-gray-200 text-gray-500 hover:border-red-300"}`,children:[r("span",{children:t.name}),o&&r("svg",{className:"w-2.5 h-2.5 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})]},t.id)})}),w.length>5&&e("button",{onClick:()=>$(!M),className:"w-full mt-4 py-2 bg-gray-50/50 rounded-xl text-red-500 text-[10px] font-bold uppercase tracking-widest flex items-center justify-center gap-2 hover:bg-gray-100 hover:text-red-700 transition-all border border-transparent hover:border-gray-200",children:[r("span",{children:M?"Скрыть лишнее":`Все подкатегории (${w.length})`}),r("svg",{className:"w-3.5 h-3.5 transition-transform duration-500 "+(M?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]})]}),C.length>0?r("div",{className:"grid grid-cols-1 xs:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 3xl:grid-cols-6 gap-4",children:C.map(e=>r(c,{product:e,filters:N},e.id))}):!L&&e("div",{className:"flex flex-col items-center justify-center py-20 px-4 text-center",children:[r("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:r(u,{className:"w-10 h-10 text-gray-400"})}),r("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:"Ничего не найдено"}),r("p",{className:"text-sm text-gray-500 max-w-xs",children:"Попробуйте изменить запрос или сбросить фильтры"}),r("button",{onClick:()=>s.get("/"),className:"mt-6 px-6 py-2 bg-red-500 text-white rounded-xl text-sm font-bold hover:bg-red-600 transition-colors",children:"Сбросить все"})]}),r("div",{ref:P,className:"h-20 flex items-center justify-center mt-4",children:L&&e("div",{className:"flex gap-2",children:[r("div",{className:"w-2 h-2 bg-red-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),r("div",{className:"w-2 h-2 bg-red-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),r("div",{className:"w-2 h-2 bg-red-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})}),O&&r("button",{onClick:()=>{var e;null==(e=F.current)||e.scrollTo({top:0,behavior:"smooth"})},className:"fixed bottom-6 right-6 w-12 h-12 bg-red-500 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-red-600 transition-all z-50",children:r(m,{className:"w-5 h-5"})})]}),((null==k?void 0:k.description)||(null==j?void 0:j.description))&&r("div",{className:"bg-gray-50 border-t border-gray-100 mt-12 py-12",children:r("div",{className:"container mx-auto px-4 max-w-4xl",children:r("section",{className:"prose prose-red prose-sm sm:prose-base max-w-none text-gray-600",dangerouslySetInnerHTML:{__html:(null==k?void 0:k.description)||(null==j?void 0:j.description)}})})})]})]})};p.layout=e=>r(a,{children:e,filters:e.props.filters});export{p as default};
